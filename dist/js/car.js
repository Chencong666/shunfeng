$(function(){function l(){$.ajax({type:"post",url:"../api/log.php",data:{fn:"car"},success:function(c){var e=JSON.parse(c);1==e.code?($(".da").css("display","block"),$(".wu").css("display","none"),function(n){var c=n.map(function(c){return'<ul class="order_lists pad qc" data-id="'+c.id+'">\n                        <li class="list_chk ch">\n                            <input type="checkbox" class="son_check">\n                        </li>   \n                        <li class="list_con">\n                            <div class="list_img"><a href="javascript:;"><img src="../'+c.imgurl+'" alt=""></a></div>\n                            <div class="list_text"><a href="javascript:;">'+c.name+'</a></div>\n                        </li>\n                        <li class="list_price pf">\n                            <p class="price">￥'+c.price+'</p>\n                        </li>\n                        <li class="list_price pf"></li>\n                        <li class="list_amount">\n                            <div class="amount_box">\n                                <a href="javascript:;" class="reduce reSty">-</a>\n                                <input type="text" value="'+c.num+'" class="sum">\n                                <a href="javascript:;" class="plus">+</a>\n                            </div>\n                        </li>\n                        <li class="list_price pf">0.05kg</li>\n                        <li class="list_sum">\n                            <p class="sum_price">￥'+c.zong+'</p>\n                        </li>\n                        <li class="list_ku pf">现货</li>\n                        <li class="list_op pf">\n                            <p class="del"><a href="javascript:;" class="delBtn">移除商品</a></p>\n                        </li>\n                    </ul>'}).join("");$(".order_content").html(c),$(".list_img").on("click",function(){var c=$(this).parent().parent().data("id");location.href="./goods.html?id="+c}),$(".list_text").on("click",function(){var c=$(this).parent().parent().data("id");location.href="./goods.html?id="+c}),1<$(".sum").val()-0?$(".reduce").attr("class","reduce"):$(".reduce").attr("class","reduce reSty");function s(c){var e=1*c.parent().parent().parent().find(".price").html().substring(1),s=1*c.parent().find("input").val(),n=(e*s).toFixed(2);c.parent().parent().parent().find(".sum_price").html("￥"+n),i()}$(".order_content").on("click",".plus",function(){var c=$(this).prev().val(),e=$(this).parent().parent().parent().data("id");1<++c?$(this).prev().prev().attr("class","reduce"):$(this).prev().prev().attr("class","reduce reSty"),$.ajax({type:"post",url:"../api/log.php",data:{fn:"add",id:e,num:c,a:"zi"},success:function(c){add("../api/log.php")}}),$(this).prev().val(c),s($(this))}),$(".order_content").on("click",".reduce",function(){var c=$(this).next().val(),e=$(this).parent().parent().parent().data("id");1<c?(c--,$(this).attr("class","reduce")):($(this).attr("class","reduce reSty"),c=1),$.ajax({type:"post",url:"../api/log.php",data:{fn:"add",id:e,num:c,a:"zi"},success:function(c){add("../api/log.php")}}),$(this).next().val(c),s($(this))}),$(".sum").blur(function(){var c=$(this).val(),e=$(this).parent().parent().parent().data("id");c.trim()&&($.ajax({type:"post",url:"../api/log.php",data:{fn:"add",id:e,a:"zi",num:c},success:function(c){add("../api/log.php")}}),$(this).val(c),s($(this)))}),$(".order_content").on("click",".del",function(){$(".model_bg").css("display","block"),$(".my_model").css("display","block");var e=$(this).parent().parent(),c=$(this).parent().parent().data("id");$(".dialog-sure").click(function(){$(".model_bg").css("display","none"),$(".my_model").css("display","none"),$.ajax({type:"post",url:"../api/log.php",data:{fn:"del",id:c},success:function(c){e.remove(),l(),i()}})}),$(".dialog-close").click(function(){$(".model_bg").css("display","none"),$(".my_model").css("display","none")}),$(".closeModel").click(function(){$(".model_bg").css("display","none"),$(".my_model").css("display","none")})}),i();var n=[];function i(){n=[];for(var c=0;c<$(".ch input").size();c++)$(".ch input").eq(c).prop("checked")&&n.push(c);n.length==$(".ch input").size()?($(".whole_check").prop("checked","checked"),$(".shopChoice").prop("checked","checked"),t(".cs")):($(".whole_check").removeAttr("checked"),$(".shopChoice").removeAttr("checked"));for(var e=0,s=0,c=0;c<n.length;c++)s+=1*$(".sum").eq(n[c]).val(),e+=1*$(".sum_price").eq(n[c]).text().substring(1);$(".piece_num").html(s),$(".totalMoney").html('商品总计：<strong class="total_text">￥'+e.toFixed(2)+"</strong>")}function t(c){$(c).click(function(){$(".model_bg").css("display","block"),$(".my_model").css("display","block"),$(".dialog-sure").click(function(){$(".model_bg").css("display","none"),$(".my_model").css("display","none"),$.ajax({type:"post",url:"../api/log.php",data:{fn:"dels"},success:function(c){l(),i()}})}),$(".dialog-close").click(function(){$(".model_bg").css("display","none"),$(".my_model").css("display","none")}),$(".closeModel").click(function(){$(".model_bg").css("display","none"),$(".my_model").css("display","none")})})}$(".whole_check").on("click",function(){$(this).prop("checked")?($(".shopChoice").prop("checked","checked"),$(".ch input").prop("checked","checked")):($(".shopChoice ").removeAttr("checked"),$(".ch input").removeAttr("checked")),i()}),$(".shopChoice").on("click",function(){$(this).prop("checked")?($(".whole_check").prop("checked","checked"),$(".ch input").prop("checked","checked")):($(".whole_check ").removeAttr("checked"),$(".ch input").removeAttr("checked")),i()}),$(".order_content").on("click",".ch input",function(){i()}),$(".cs").click(function(){$(".model_bg").css("display","block"),$(".my_model").css("display","block"),$(".dialog-sure").click(function(){$(".model_bg").css("display","none"),$(".my_model").css("display","none");for(var e=n.length-1;0<=e;e--){var c=$(".order_content ul").eq(n[e]).data("id");$.ajax({type:"post",url:"../api/log.php",data:{fn:"del",id:c},success:function(c){$(".order_content ul").eq(n[e]).remove(),l(),i()}})}}),$(".dialog-close").click(function(){$(".model_bg").css("display","none"),$(".my_model").css("display","none")}),$(".closeModel").click(function(){$(".model_bg").css("display","none"),$(".my_model").css("display","none")})}),t(".cu")}(e.list)):($(".da").css("display","none"),$(".wu").css("display","block"))}})}l(),$(".goshop").click(function(){location.href="../index.html"}),cook("../api/log.php")});